## Ceph(ì„¸í”„)ë¥¼ Proxmoxì— ì„¤ì§€í•˜ê¸° 

### ì‚¬ì „ ì¡°ê±´ 
1. nvme ë””ìŠ¤í¬ 500G, SATA ë””ìŠ¤í¬ 1Të¥¼ ì¤€ë¹„í•œë‹¤.
2. 10G NIC 2í¬íŠ¸ë¥¼ ì¤€ë¹„í•œë‹¤
3. ceph cluster êµ¬ì„±ì„ í•œ PC 4ëŒ€

### ê°œìš”
- NVMe ë””ìŠ¤í¬ ì „ì²´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ 
- **OS ìš©ë„ë¡œ 300Gë§Œ ì‚¬ìš©**
- ë‚˜ë¨¸ì§€ ê³µê°„ì€ Ceph DB/WAL, DB ì„œë²„ ë“±ìœ¼ë¡œ í™œìš©

### ì„¤ì¹˜ ë°©ë²• í•µì‹¬
- Proxmox ì„¤ì¹˜ í™”ë©´ì—ì„œ **Options (Advanced Options)** í´ë¦­
- `hdsize=300` ì„¤ì •

### ê²°ê³¼ êµ¬ì¡° ì˜ˆì‹œ
```
nvme0n1 (500G)
â”œâ”€ EFI /boot
â”œâ”€ pve-root
â”œâ”€ pve-swap
â”œâ”€ pve-data
â””â”€ (ë¯¸ì‚¬ìš© ì˜ì—­ ì•½ 200G)
```

---

## 2. LVM êµ¬ì¡° ê°œë… ì •ë¦¬

### LVM 3ë‹¨ê³„ êµ¬ì¡°
| ë‹¨ê³„ | ì´ë¦„ | ì„¤ëª… |
|----|----|----|
| 1 | PV (Physical Volume) | ì‹¤ì œ ë””ìŠ¤í¬/íŒŒí‹°ì…˜ |
| 2 | VG (Volume Group) | PV ë¬¶ìŒ |
| 3 | LV (Logical Volume) | ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ë…¼ë¦¬ ë³¼ë¥¨ |

Ceph DB/WALì€ **íŒŒì¼ì‹œìŠ¤í…œ ì—†ì´ Raw Block(LVM)** í˜•íƒœë¡œ ì‚¬ìš©.

---

## 3. NVMe ë‚¨ì€ ì˜ì—­ì„ Ceph ì „ìš© VGë¡œ êµ¬ì„±

### íŒŒí‹°ì…˜ ì˜ˆ
- `/dev/nvme0n1p3` : Proxmox ì„¤ì¹˜ í›„ ë‚¨ì€ ì˜ì—­

### PV ìƒì„±
```bash
pvcreate /dev/nvme0n1p3
```

### VG ìƒì„±
```bash
vgcreate ceph-vg /dev/nvme0n1p3
```

### í™•ì¸
```bash
pvs
vgs
```

---

## 4. Ceph BlueStore DB / WAL ê°œë…

### BlueStore ë‚´ë¶€ êµ¬ì¡°
```
OSD DATA (HDD)
â””â”€ BlueStore
   â”œâ”€ block      (DATA)
   â”œâ”€ block.db   (Metadata, NVMe)
   â””â”€ block.wal  (Write Ahead Log, NVMe)
```

### ê¶Œì¥ í¬ê¸°
| í•­ëª© | í¬ê¸° |
|----|----|
| DB | 50G |
| WAL | 8G |

---

## 5. Ceph DB 50G / WAL 8G ìƒì„± ë°©ë²•

### DB LV ìƒì„±
```bash
lvcreate -L 50G -n osd-db-1 ceph-vg
```

### WAL LV ìƒì„±
```bash
lvcreate -L 8G -n osd-wal-1 ceph-vg
```

### í™•ì¸
```bash
lvs
```

---

## 6. 1TB ë””ìŠ¤í¬ (/dev/sdb) ë¥¼ Ceph OSDë¡œ ìƒì„±

### ì‚¬ì „ í™•ì¸
```bash
lsblk
```

### 7. í˜„ì¬ ë””ìŠ¤í¬ ìƒíƒœ ìš”ì•½ (ì¤‘ìš”)
```text
ğŸ”¹ nvme0n1 (476G)
Proxmox OS ì „ìš©
/ , swap, pve-data
```
ğŸ‘‰ ê±´ë“œë¦¬ë©´ ì•ˆ ë¨
```text
ğŸ”¹ sda (1TB HDD)
ì˜ˆì „ì— Proxmox ì„¤ì¹˜ì— ì‚¬ìš©ëœ í”ì  ì¡´ì¬
VG ì´ë¦„: pve-OLD-E7ADA11C
```
Ceph OSDë¡œ ì‚¬ìš©í•˜ë ¤ë©´ ì™„ì „ ì´ˆê¸°í™” í•„ìš”

Ceph OSDëŠ” ì ˆëŒ€ LVM ìœ„ì— ë§Œë“¤ì§€ ì•ŠìŠµë‹ˆë‹¤
â†’ ë””ìŠ¤í¬ ì „ì²´ë¥¼ RAW ìƒíƒœë¡œ ì‚¬ìš©

### 8. ì „ì²´ ì ˆì°¨ ìš”ì•½ (ì •ì„ ë£¨íŠ¸)
1. sdaì— ë‚¨ì•„ìˆëŠ” LVM / íŒŒí‹°ì…˜ ì™„ì „ ì œê±°
2. ë””ìŠ¤í¬ë¥¼ "ë¹ˆ ë””ìŠ¤í¬" ìƒíƒœë¡œ ë§Œë“¤ê¸°
3. Proxmox GUI ë˜ëŠ” CLIì—ì„œ Ceph OSD ìƒì„±
4. Ceph ìƒíƒœ í™•ì¸

### 9. sda ê¸°ì¡´ LVM / íŒŒí‹°ì…˜ ì™„ì „ ì œê±°
1. LVM ë…¼ë¦¬ ë³¼ë¥¨ ì œê±°
lvremove -y pve-OLD-E7ADA11C/data
lvremove -y pve-OLD-E7ADA11C/swap
lvremove -y pve-OLD-E7ADA11C/root


í™•ì¸:
```bash
lvs
```
2. VG ì œê±°
   
```bash
vgremove -y pve-OLD-E7ADA11C
```

í™•ì¸:
```bash
vgs
```

3. PV ì œê±°
```bash
pvremove -y /dev/sda3
```

í™•ì¸:
```bash
pvs
```

### 10. íŒŒí‹°ì…˜ í…Œì´ë¸” ì™„ì „ ì‚­ì œ (ì¤‘ìš”)
ë°©ë²• 1ï¸âƒ£ (ê¶Œì¥ â€“ ê°€ì¥ ê¹¨ë—)
```bash
sgdisk --zap-all /dev/sda
```

ë˜ëŠ”
```bash
wipefs -a /dev/sda
```

ì¶”ê°€ë¡œ í™•ì‹¤íˆ ì§€ìš°ê³  ì‹¶ë‹¤ë©´ (ì„ íƒ)
```bash
dd if=/dev/zero of=/dev/sda bs=1M count=100
```

ì¬ë¶€íŒ… ë˜ëŠ” ì»¤ë„ ë°˜ì˜
```bash
partprobe
```

ë˜ëŠ”

```bash
reboot
```

ìƒíƒœ í™•ì¸ (ì´ê²Œ ë‚˜ì™€ì•¼ ì •ìƒ)

```bash
lsblk
```

ì •ìƒ ì˜ˆì‹œ:
```text
sda   8:0   0 931.5G 0 disk
```

âŒ íŒŒí‹°ì…˜ì´ ë³´ì´ë©´ ì•ˆ ë¨

---

### 11. 10G ì „ìš© ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ ì„¤ì¹˜ ì ˆì°¨ 

1. ì„¤ì¹˜í•˜ë ¤ëŠ” ì»´í“¨í„°ì˜ ì „ì›ì„ off í•œë‹¤
2. ë©”ì¸ë³´ë“œì— NIC ì¹´ë“œë¥¼ ì—°ê²°í•œë‹¤
3. ë©”ì¸ë³´ë“œì— ì—°ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” PCI 4 ë°°ì† portê°€ ìˆì–´ì•¼ í•œë‹¤
4. ë©”ì¸ë³´ë“œì— NICì„ ì—°ê²°í•˜ê³  SFP ì¼€ì´ë¸”ì„ ìŠ¤ìœ„ì¹˜ì™€ ì—°ê²°í•œë‹¤
5. ì»´í“¨í„°ë¥¼ ë¶€íŒ…í•œë‹¤

### 12. PCIe ì¥ì¹˜ ì¸ì‹ ì—¬ë¶€ í™•ì¸
```bash
lspci | grep -i mellanox

```

ì •ìƒ ì˜ˆì‹œ:

```text
01:00.0 Ethernet controller: Mellanox Technologies MT27500 Family [ConnectX-3]
```

---

### 13. ì»¤ë„ ë“œë¼ì´ë²„ ë¡œë“œ í™•ì¸ (mlx4_en)

```bash
lsmod | grep mlx4
```

---

### 14. ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ìƒì„± í™•ì¸ 
```
ip a
```

ì •ìƒ ì˜ˆì‹œ :

```text

1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: nic0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master vmbr0 state UP group default qlen 1000
    link/ether d8:43:ae:2b:6e:b5 brd ff:ff:ff:ff:ff:ff
    altname enp0s31f6
    altname enxd843ae2b6eb5
3: nic1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master vmbr1 state DOWN group default qlen 1000
    link/ether f4:52:14:19:bd:70 brd ff:ff:ff:ff:ff:ff
    altname enxf4521419bd70
4: nic2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master vmbr2 state DOWN group default qlen 1000
    link/ether f4:52:14:19:bd:71 brd ff:ff:ff:ff:ff:ff
    altname enxf4521419bd71
5: vmbr0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether d8:43:ae:2b:6e:b5 brd ff:ff:ff:ff:ff:ff
    inet 192.168.3.94/24 scope global vmbr0
       valid_lft forever preferred_lft forever
    inet6 fe80::da43:aeff:fe2b:6eb5/64 scope link proto kernel_ll
       valid_lft forever preferred_lft forever
```

ë˜ëŠ” 

```
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master vmbr0 state UP group default qlen 1000
    link/ether d8:43:ae:40:e7:8e brd ff:ff:ff:ff:ff:ff
    altname enp0s31f6
    altname enxd843ae40e78e
3: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master vmbr1 state UP group default qlen 1000
    link/ether 00:02:c9:1f:0f:00 brd ff:ff:ff:ff:ff:ff
    altname enx0002c91f0f00
4: enp1s0d1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master vmbr2 state UP group default qlen 1000
    link/ether 00:02:c9:1f:0f:01 brd ff:ff:ff:ff:ff:ff
    altname enx0002c91f0f01
5: vmbr0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether d8:43:ae:40:e7:8e brd ff:ff:ff:ff:ff:ff
    inet 192.168.3.107/24 scope global vmbr0
       valid_lft forever preferred_lft forever
    inet6 fe80::da43:aeff:fe40:e78e/64 scope link proto kernel_ll
       valid_lft forever preferred_lft forever
```
ë¬¼ë¦¬ì  NIC ëª…ìœ¼ë¥´ í™•ì¸í•œë‹¤ 

nic1, nic2, enp1s0, enp1s0d1ì™€ ê°™ì€ ì´ë¦„ì„ ìˆëŠ”ì§€ í™•ì¸ í•©ë‹ˆë‹¤ 

---

### 15. ë„¤íŠ¸ì›©íŠ¸ ì¸í„°í˜ì´ìŠ¤ì— ë‚´ë¶€ IPë¥¼ ì„¤ì •
```bash
vi /etc/network/interfaces

auto lo
iface lo inet loopback

#ì™¸ë¶€ ì¸í„°ë„·ì„ ìœ„í•œ ì„¤ì • 
iface nic0 inet manual

#ì™¸ë¶€ ì¸í„°ë„·ì„ ìœ„í•œ ì„¤ì • ip ì„¤ì • 
auto vmbr0
iface vmbr0 inet static
        address 192.168.3.94/24
        gateway 192.168.3.1
        bridge-ports nic0
        bridge-stp off
        bridge-fd 0

#1ë²ˆì§¸ 10G NIC ë‚´ë¶€ í†µì‹ ì„ ìœ„í•œ ì„¤ì • ip ì„¤ì • 
iface nic1 inet manual
        mtu 9000

auto vmbr1
iface vmbr1 inet static
        address 10.10.10.101/24
        bridge-ports nic1
        bridge-stp off
        bridge-fd 0
        mtu 9000

#2ë²ˆì§¸ 10G NIC ë‚´ë¶€ í†µì‹ ì„ ìœ„í•œ ì„¤ì • ip ì„¤ì • 
iface nic2 inet manual
        mtu 9000

auto vmbr2
iface vmbr2 inet static
        address 10.10.20.101/24
        bridge-ports nic2
        bridge-stp off
        bridge-fd 0
        mtu 9000

source /etc/network/interfaces.d/*
```

---

### 16. ìˆ˜ì •í•œ NIC ì •ë³´ë¥¼ ë¦¬ë¡œë”©

```bash
ifreload -a 
```

---

### 17. 10G IPë¥¼ í™•ì¸

```bash
ip a

ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: nic0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master vmbr0 state UP group default qlen 1000
    link/ether d8:43:ae:2b:6e:b5 brd ff:ff:ff:ff:ff:ff
    altname enp0s31f6
    altname enxd843ae2b6eb5
3: nic1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master vmbr1 state UP group default qlen 1000
    link/ether f4:52:14:19:bd:70 brd ff:ff:ff:ff:ff:ff
    altname enxf4521419bd70
4: nic2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master vmbr2 state UP group default qlen 1000
    link/ether f4:52:14:19:bd:71 brd ff:ff:ff:ff:ff:ff
    altname enxf4521419bd71
5: vmbr0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether d8:43:ae:2b:6e:b5 brd ff:ff:ff:ff:ff:ff
    inet 192.168.3.94/24 scope global vmbr0
       valid_lft forever preferred_lft forever
    inet6 fe80::da43:aeff:fe2b:6eb5/64 scope link proto kernel_ll
       valid_lft forever preferred_lft forever
6: vmbr1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc noqueue state UP group default qlen 1000
    link/ether f4:52:14:19:bd:70 brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.101/24 scope global vmbr1
       valid_lft forever preferred_lft forever
    inet6 fe80::f652:14ff:fe19:bd70/64 scope link proto kernel_ll
       valid_lft forever preferred_lft forever
7: vmbr2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc noqueue state UP group default qlen 1000
    link/ether f4:52:14:19:bd:71 brd ff:ff:ff:ff:ff:ff
    inet 10.10.20.101/24 scope global vmbr2
       valid_lft forever preferred_lft forever
    inet6 fe80::f652:14ff:fe19:bd71/64 scope link proto kernel_ll
       valid_lft forever preferred_lft forever

```

nic1, nic2ì˜ ê²°ê³¼ì— UPë¼ê³  í‘œì‹œê°€ ë˜ì–´ì•¼ í•¨

---

### 18. 10G ì†ë„ í™•ì¸ 
```bash
# ì†ë„ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨  
apt install -y iperf3

#ì„¤ì¹˜ì¤‘ ì„œë²„ êµ¬ë™ í™•ì¸í•  ê²ƒ 

#ë‹¤ë¥¸ ì„œë²„ì— ì ‘ì†í•˜ì—¬ ì†ë„ë¥¼ í™•ì¸í•œë‹¤
iperf3 -c IP

iperf3 -c 10.10.10.104
Connecting to host 10.10.10.104, port 5201
[  5] local 10.10.10.101 port 40416 connected to 10.10.10.104 port 5201
[ ID] Interval           Transfer     Bitrate         Retr  Cwnd
[  5]   0.00-1.00   sec  1.16 GBytes  9.91 Gbits/sec    0   1.30 MBytes
[  5]   1.00-2.00   sec  1.15 GBytes  9.89 Gbits/sec    0   1.30 MBytes
[  5]   2.00-3.00   sec  1.15 GBytes  9.89 Gbits/sec    0   1.30 MBytes
[  5]   3.00-4.00   sec  1.15 GBytes  9.89 Gbits/sec    0   1.30 MBytes
[  5]   4.00-5.00   sec  1.15 GBytes  9.88 Gbits/sec    0   1.30 MBytes
[  5]   5.00-6.00   sec  1.15 GBytes  9.88 Gbits/sec    0   1.30 MBytes
[  5]   6.00-7.00   sec  1.15 GBytes  9.89 Gbits/sec    0   1.30 MBytes
[  5]   7.00-8.00   sec  1.15 GBytes  9.89 Gbits/sec    0   1.30 MBytes
[  5]   8.00-9.00   sec  1.15 GBytes  9.88 Gbits/sec    0   1.30 MBytes
[  5]   9.00-10.00  sec  1.15 GBytes  9.90 Gbits/sec    0   1.30 MBytes
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec  11.5 GBytes  9.89 Gbits/sec    0            sender
[  5]   0.00-10.00  sec  11.5 GBytes  9.89 Gbits/sec                  receiver

iperf Done.

```

---

### 19. 10Gì˜ ì†ë„ê°€ ë‚˜ì˜¤ì§€ ì•Šì„ ë•ŒëŠ” ë§ì€ ê²½ìš°ê°€ ìˆìŒ 

1. ìŠ¤ìœ„ì¹˜ ë¦¬ìŠ¤íƒ€íŠ¸ë¥¼ í•œë‹¤
2. ë©”ì¸ë³´ë“œì—ì„œ ì œê³µí•˜ëŠ” PCIì˜ ì†ë„ê°€ 4ë°°ì† ì´ìƒì¸ì§€ë¥¼ í™•ì¸í•œë‹¤
3. biosì—  PCIë¥¼ 4ë°°ì† ì´ìƒì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ë‹¤.
4. ìŠ¤ìœ„ì¹˜ì˜ MTUë¥¼ 9000ìœ¼ë¡œ ì„¤ì •í•œë‹¤

### 20. ìŠ¤ìœ„ì¹˜ì˜ MTUë¥¼ 9000ìœ¼ë¡œ ì„¤ì •

1. ìŠ¤ìœ„ì¹˜ë¥¼ RC232Cë¡œ ì»´í“¨í„°ì™€ ì—°ê²°í•œë‹¤.
2. USB2COM í¬íŠ¸ê°€ ì–´ë–¤ í¬íŠ¸ì— ë°°ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤
3. ì¥ì¹˜ê´€ë¦¬ì <img width="1702" height="1053" alt="image" src="https://github.com/user-attachments/assets/eb8b87d4-7867-42d4-9e31-90173d7d0b54" />
4. puttyë¥¼ ì´ìš©í•˜ì—¬ ì‹œë¦¬ì–¼ ì—°ê²°í•œë‹¤
5. <img width="829" height="810" alt="image" src="https://github.com/user-attachments/assets/da8ceb57-0800-4f9f-8526-acc8d23e6354" />
6. ìŠ¤ìœ„ì¹˜ì˜ ì „ì›ì„ ë‹¤ì‹œ ì¼ ë‹¤
7. puttyì˜ í„°ë¯¸ë„ ì°½ì— ë¡œê·¸ê°€ ì¶œë ¥ëœë‹¤
8. admin/admin ìœ¼ë¡œ ë¡œê·¸ì¸í•œë‹¤
9.  <img width="1156" height="656" alt="image" src="https://github.com/user-attachments/assets/91bf5c77-75bd-48d1-8163-07b1bb0dba3e" />
10. config terminal
11. mtu 9000
12. exit
13. write ìœ¼ë¡œ í˜„ì¬ì˜ ìƒíƒœë¥¼ ì €ì¥í•œë‹¤
14. show interface ëª…ë ¹ìœ¼ë¡œ ê° í¬íŠ¸ì˜ mtu ê°€ 9000ìœ¼ë¡œ ì„¤ì •ëœ ê²ƒì„ í™•ì¸í•œë‹¤
15. <img width="1156" height="656" alt="image" src="https://github.com/user-attachments/assets/c4c6481e-21c0-4587-a85d-75cfef076d94" />

---

###  21. Ceph Cluster (Proxmox í´ëŸ¬ìŠ¤í„°) êµ¬ì„±

#### â‘  ì²« ë²ˆì§¸ ë…¸ë“œì—ì„œ
```bash
pvecm create ceph-cluster
```

#### â‘¡ ë‚˜ë¨¸ì§€ 3ëŒ€ ë…¸ë“œì—ì„œ
```bash
pvecm add <ì²«ë²ˆì§¸ë…¸ë“œIP>
```

#### â‘¢ í™•ì¸
```bash
pvecm status
```
ê²°ê³¼ : 
ëª¨ë“  ë…¸ë“œ Online ìƒíƒœì—¬ì•¼ í•¨

---

### 22. Ceph ë„¤íŠ¸ì›Œí¬ í™•ì¸

ê¶Œì¥
- public network: VM / ê´€ë¦¬ / MON
- cluster network: OSD replication (ê°€ëŠ¥í•˜ë©´ ë³„ë„ NIC)

í™•ì¸
```bash
cat /etc/pve/ceph.conf
```

ì˜ˆì‹œ
```ini
[global]
public_network = 10.10.10.0/24
cluster_network = 10.10.20.0/24
```
âš ï¸ ì•„ì§ ì—†ìœ¼ë©´ OSD ìƒì„± ì „ì— ê¼­ ì„¤ì •

---

### 23. Ceph MON & MGR ìƒì„±
Proxmox GUI ê¸°ì¤€ (ê¶Œì¥)

#### Datacenter â†’ Ceph â†’ Monitor
- ê° ë…¸ë“œì— MON 1ê°œì”©
- ìµœì†Œ 3ê°œ ì´ìƒ

#### Manager ìƒì„±
```bash
ceph mgr stat
```
âœ”ï¸ Active / Standby êµ¬ì¡° ìë™ êµ¬ì„±ë¨

---

### 24. OSD ìƒì„± ëª…ë ¹
```bash
ceph-volume lvm create   --data /dev/sdb   --block-db ceph-vg/osd-db-1   --block-wal ceph-vg/osd-wal-1
```

### 25. ìƒì„± í›„ í™•ì¸
```bash
ceph osd tree
ceph osd df
ceph-volume lvm list
```

---

### 26. Ceph ìƒíƒœ ì•ˆì •í™” í™•ì¸ (ê°€ì¥ ì¤‘ìš”)
```bash
ceph -s
```
ì •ìƒ ìƒíƒœ ì˜ˆì‹œ
```text
HEALTH_OK
4 mons at quorum
4 osds: 4 up, 4 in

```
âš ï¸ ì´ ë‹¨ê³„ì—ì„œ WARNING / DEGRADED ìˆìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ í•˜ë©´ ì•ˆë¨ 

---

### 27. PG / CRUSH ê¸°ë³¸ ì ê²€

PG ìë™ ê³„ì‚° í™•ì¸
```bash
ceph osd pool autoscale-status
```

PG ê¶Œì¥ê°’
- OSD 4ê°œ â†’ PG autoscale ON ê¶Œì¥

í™•ì¸
```bash
ceph config get osd osd_pool_default_pg_autoscale_mode
```

### 28. Ceph Pool ìƒì„±
RBD í’€ (VMìš©)
```bash
ceph osd pool create rbd
ceph osd pool application enable rbd rbd
```

ê¶Œì¥ ì˜µì…˜
```bash
ceph osd pool set rbd size 3
ceph osd pool set rbd min_size 2
```
âœ”ï¸ 4ë…¸ë“œ â†’ ë³µì œ 3 ê¶Œì¥


### 29. Proxmoxì— Ceph Storage ë“±ë¡
**Datacenter â†’ Storage â†’ Add â†’ RBD** 
| í•­ëª©      | ê°’          |
| ------- | ---------- |
| Pool    | rbd        |
| Content | Disk Image |
| Nodes   | ì „ì²´         |

í™•ì¸
```bash
pvesm status
```

### 30. ìš´ì˜ ìµœì í™”
OSD ì„±ëŠ¥
```bash
ceph config set osd osd_memory_target 4G
```

Scrub ì‹œê°„ ì¡°ì •
```bash
ceph config set osd osd_scrub_begin_hour 1
ceph config set osd osd_scrub_end_hour 6
```

---

### 31. Scrub ì´ë€ ë¬´ì—‡ì¸ê°€?

**Scrub = ë°ì´í„° ì •í•©ì„± ê²€ì‚¬**

CephëŠ” ë””ìŠ¤í¬, ë„¤íŠ¸ì›Œí¬, ë…¸ë“œê°€ ë§ê¸° ë•Œë¬¸ì—
ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* ë¹„íŠ¸ ë¡œíŠ¸(Bit rot)
* ë””ìŠ¤í¬ ì¡°ìš©í•œ ì˜¤ë¥˜(Silent corruption)
* ë³µì œë³¸ ê°„ ë°ì´í„° ë¶ˆì¼ì¹˜
* ë©”íƒ€ë°ì´í„° ì†ìƒ

ğŸ‘‰ ì´ë¥¼ **ë¯¸ë¦¬ ë°œê²¬í•˜ê¸° ìœ„í•´ ì£¼ê¸°ì ìœ¼ë¡œ ê²€ì‚¬**í•˜ëŠ” ê²ƒì´ Scrubì…ë‹ˆë‹¤.

---

## 1ï¸âƒ£ Scrub ì´ë€ ë¬´ì—‡ì¸ê°€?

**Scrub = ë°ì´í„° ì •í•©ì„± ê²€ì‚¬**

CephëŠ” ë””ìŠ¤í¬, ë„¤íŠ¸ì›Œí¬, ë…¸ë“œê°€ ë§ê¸° ë•Œë¬¸ì—
ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* ë¹„íŠ¸ ë¡œíŠ¸(Bit rot)
* ë””ìŠ¤í¬ ì¡°ìš©í•œ ì˜¤ë¥˜(Silent corruption)
* ë³µì œë³¸ ê°„ ë°ì´í„° ë¶ˆì¼ì¹˜
* ë©”íƒ€ë°ì´í„° ì†ìƒ

ğŸ‘‰ ì´ë¥¼ **ë¯¸ë¦¬ ë°œê²¬í•˜ê¸° ìœ„í•´ ì£¼ê¸°ì ìœ¼ë¡œ ê²€ì‚¬**í•˜ëŠ” ê²ƒì´ Scrubì…ë‹ˆë‹¤.

---

## 2ï¸âƒ£ Scrub ì¢…ë¥˜

### ğŸ”¹ 1. Scrub (Light Scrub)

* **ë©”íƒ€ë°ì´í„° ìœ„ì£¼ ê²€ì‚¬**
* ê°ì²´ ì¡´ì¬ ì—¬ë¶€, í¬ê¸°, ì²´í¬ì„¬ ë“± í™•ì¸
* ë¶€í•˜ê°€ ë¹„êµì  ë‚®ìŒ

### ğŸ”¹ 2. Deep Scrub

* **ì‹¤ì œ ë°ì´í„°ê¹Œì§€ ì½ì–´ì„œ ê²€ì‚¬**
* ë³µì œë³¸ ê°„ ë°ì´í„° ë¹„êµ
* ë””ìŠ¤í¬ I/O ë¶€í•˜ í¼
* ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼

---

## 3ï¸âƒ£ Scrub ì‹œê°„ ì¡°ì •ì´ í•„ìš”í•œ ì´ìœ 

Scrubì€ **í´ëŸ¬ìŠ¤í„° ì„±ëŠ¥ì— ì§ì ‘ì ì¸ ì˜í–¥**ì„ ì¤ë‹ˆë‹¤.

### ğŸš¨ ê¸°ë³¸ ì„¤ì • ê·¸ëŒ€ë¡œ ë‘ë©´

* ì£¼ê°„ / ì£¼ë§ / ë‚® ì‹œê°„ì—ë„ scrub ì‹¤í–‰
* VM ë””ìŠ¤í¬, DB I/O ì„±ëŠ¥ ì €í•˜
* Ceph latency ì¦ê°€
* êµìœ¡/ì‹¤ìŠµ í™˜ê²½ì—ì„œ ì²´ê° ì‹¬í•¨

### âœ… ê·¸ë˜ì„œ ë³´í†µ

* **ì•¼ê°„ì—ë§Œ ìˆ˜í–‰**
* **ì—…ë¬´ ì‹œê°„ì—ëŠ” ì¤‘ë‹¨ ë˜ëŠ” ìµœì†Œí™”**
* **Deep scrub ì£¼ê¸° ëŠ˜ë¦¼**

ì„ í•©ë‹ˆë‹¤.

---

## 4ï¸âƒ£ Scrub ì‹œê°„ ì¡°ì •ì´ë€ ë¬´ì—‡ì„ ì¡°ì •í•˜ëŠ”ê°€?

### ğŸ“Œ 1. Scrub í—ˆìš© ì‹œê°„ëŒ€

> ì–¸ì œ Scrubì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ê°€

* `osd_scrub_begin_hour`
* `osd_scrub_end_hour`

ì˜ˆì‹œ:

```bash
ceph config set osd osd_scrub_begin_hour 1
ceph config set osd osd_scrub_end_hour 7
```

â¡ï¸ **ìƒˆë²½ 1ì‹œ ~ 7ì‹œ**ì—ë§Œ scrub í—ˆìš©

---

### ğŸ“Œ 2. Scrub ë¹ˆë„ (ì£¼ê¸°)

| í•­ëª©                        | ì˜ë¯¸            | ê¸°ë³¸ê°’(ëŒ€ëµ) |
| ------------------------- | ------------- | ------- |
| `osd_scrub_min_interval`  | ìµœì†Œ ì£¼ê¸°         | 1ì¼      |
| `osd_scrub_max_interval`  | ìµœëŒ€ ì§€ì—°         | 7ì¼      |
| `osd_deep_scrub_interval` | Deep scrub ì£¼ê¸° | 7~14ì¼   |

ì˜ˆì‹œ:

```bash
ceph config set osd osd_scrub_min_interval 172800   # 2ì¼
ceph config set osd osd_scrub_max_interval 604800   # 7ì¼
ceph config set osd osd_deep_scrub_interval 1209600 # 14ì¼
```

---

### ğŸ“Œ 3. Scrub ë™ì‹œì„± / ê°•ë„ ì¡°ì ˆ

| ì„¤ì •                   | ì„¤ëª…                      |
| -------------------- | ----------------------- |
| `osd_max_scrubs`     | OSDë‹¹ ë™ì‹œì— ìˆ˜í–‰ ê°€ëŠ¥í•œ scrub ìˆ˜ |
| `osd_scrub_sleep`    | ê°ì²´ ì²˜ë¦¬ ì‚¬ì´ ëŒ€ê¸°ì‹œê°„           |
| `osd_scrub_priority` | scrub ìš°ì„ ìˆœìœ„              |

ì˜ˆì‹œ:

```bash
ceph config set osd osd_max_scrubs 1
ceph config set osd osd_scrub_sleep 0.1
```

â¡ï¸ **ì²œì²œíˆ, ëœ ê³µê²©ì ìœ¼ë¡œ ìˆ˜í–‰**

---

## 5ï¸âƒ£ Scrub ì‹œê°„ ì¡°ì • ì•ˆ í•˜ë©´ ìƒê¸°ëŠ” ë¬¸ì œ

| ìƒí™©            | ê²°ê³¼             |
| ------------- | -------------- |
| Scrub ë¯¸ì‹¤í–‰     | ë°ì´í„° ì†ìƒ ë°œê²¬ ëª»í•¨   |
| ê³¼ë„í•œ Scrub     | VM, DB ì„±ëŠ¥ ê¸‰ë½   |
| ë‚® ì‹œê°„ Scrub    | êµìœ¡/ì‹¤ìŠµ ì²´ê° ì„±ëŠ¥ ì €í•˜ |
| Deep scrub ê³¼ë‹¤ | ë””ìŠ¤í¬ ìˆ˜ëª… ê°ì†Œ      |

ğŸ‘‰ **ì ì ˆí•œ ì‹œê°„ + ì ì ˆí•œ ë¹ˆë„**ê°€ í•µì‹¬

---

## 6ï¸âƒ£ ì‹¤ë¬´ ê¶Œì¥ ì„¤ì • (êµìœ¡/Proxmox + Ceph í™˜ê²½)

ğŸ’¡ í˜„ì¬ êµ¬ì„±(ë‹¤ìˆ˜ VM, 1G/10G í˜¼í•©ë§, HDD OSD ê¸°ì¤€)ì„ ê³ ë ¤í•˜ë©´:

```bash
# Scrub í—ˆìš© ì‹œê°„: ìƒˆë²½
ceph config set osd osd_scrub_begin_hour 1
ceph config set osd osd_scrub_end_hour 7

# ì£¼ê¸° ì™„í™”
ceph config set osd osd_scrub_min_interval 259200     # 3ì¼
ceph config set osd osd_scrub_max_interval 604800     # 7ì¼
ceph config set osd osd_deep_scrub_interval 1209600   # 14ì¼

# ë¶€í•˜ ì™„í™”
ceph config set osd osd_max_scrubs 1
ceph config set osd osd_scrub_sleep 0.1
```

---

## 7ï¸âƒ£ Scrub ìƒíƒœ í™•ì¸ ëª…ë ¹ì–´

```bash
ceph -s
ceph health detail
ceph pg dump | grep scrub
```

---

ê¹Œì§€ ì´ì–´ì„œ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.
