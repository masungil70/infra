## Proxmox 가상화 환경 시스템 구조도


사용자와 외부 네트워크를 상단에, 물리적인 하드웨어를 하단에 배치하여 데이터 흐름과 의존성 관점에서 표현한 구조입니다.

  Proxmox 가상화 환경 시스템 구조도
```
 [ 사용자 (관리용 PC 또는 스마트폰) ]      [ 인터넷 / 내부 네트워크 (공유기) ]
         |                                      |
  (웹 브라우저, RDP 등 원격 접속)               |
         |                                      |
         +--------------------------------------|
                                                |
 +----------------------------------------------|---------------------------------------------+
 |  +--------------------[ 물리 NIC (랜카드) ]--|------------------------------------------+  |
 |  |                                           ^                                          |  |
 |  |  +----------------------------------------|---------------------------------------+  |  |
 |  |  |                                        | (물리 NIC와 연결)                     |  |  |
 |  |  |  +-------------------------------------V------------------------------------+  |  |  |  
 |  |  |  |                                                                          |  |  |  |
 |  |  |  |               가상 스위치 (Linux Bridge: vmbr0)                          |  |  |  |
 |  |  |  |                                                                          |  |  |  |
 |  |  |  +-------^-------------------------^------------------------^---------------+  |  |  |
 |  |  |          | (가상 랜선)             | (가상 랜선)            | (가상 랜선)      |  |  |
 |  |  |          |                         |                        |                  |  |  |
 |  |  |  +-------|-----------+   +---------|---------+   +----------|---------------+  |  |  |
 |  |  |  |  Xubuntu Desktop  |   |  Alpine Linux     |   |      Ubuntu Server       |  |  |  |
 |  |  |  |  (메인 PC 역할)   |   |  (경량 서버 1)    |   |      (경량 서버 2)       |  |  |  |
 |  |  |  |-------------------|   |-------------------|   |--------------------------|  |  |  |
 |  |  |  | vCPU: 2, vRAM: 3G |   | vCPU: 2, vRAM: 2G |   | vCPU: 2, vRAM: 2G        |  |  |  |
 |  |  |  | vDisk: 64G        |   | vDisk: 32G        |   | vDisk: 32G               |  |  |  |
 |  |  |  |   [가상 NIC]      |   |   [가상 NIC]      |   |      [가상 NIC]          |  |  |  |
 |  |  |  +-------------------+   +-------------------+   +--------------------------+  |  |  |
 |  |  |                                                                                |  |  |
 |  |  |                     [ Proxmox VE (하이퍼바이저 OS) ]                           |  |  |
 |  |  +--------------------------------------------------------------------------------+  |  |
 |  |                                                                                      |  |
 |  +----               [ 물리 컴퓨터 (i7-9세대, 16GB RAM, 512GB SSD) ]           ---------+  |
 |                                                                                            |
 +--------------------------------------------------------------------------------------------+
```

  구조 설명 

   1. 사용자 / 외부 네트워크 (상단): 모든 요청은 사용자의 원격 PC나 외부 인터넷에서 시작됩니다.

   2. 물리 NIC (랜카드): 외부의 요청이 가장 먼저 도달하는 물리적인 하드웨어 관문입니다.

   3. 가상 스위치 (vmbr0): 물리 NIC를 통해 들어온 트래픽을 Proxmox 내부의 가상 스위치가 받아, 목적지에 맞는 가상머신으로 전달해주는 '교통 경찰' 역할을 합니다.

   4. 가상머신 (VMs): 가상 스위치에 연결된 각각의 독립적인 컴퓨터들입니다. 외부 요청을 처리하거나, 사용자가 원격으로 접속하여 '메인 PC'처럼 사용합니다.

   5. Proxmox VE (하이퍼바이저): 이 모든 가상머신들과 가상 네트워크를 총괄하여 실행시키는 운영체제입니다.

   6. 물리 컴퓨터 (하단): Proxmox VE와 그 위의 모든 가상머신들이 실제로 사용하는 CPU, RAM, SSD 등 하드웨어 자원의 기반입니다.
   
---
### 이와 같은 시스템을 구성하는 이유 

이 과정을 이해하시면 가상화와 서버 운영에 대한 깊은 통찰을 얻으실 수 있습니다.

  모든 것의 시작: 목표와 딜레마

  우리의 가장 첫 목표는 단순했습니다.
  "컴퓨터 1대에서 클라이언트(Xubuntu)와 여러 서버(Ubuntu, Alpine)를 동시에 실행하고 싶다."

  이 목표를 달성하기 위해 Proxmox라는 하이퍼바이저를 설치하는 것은 훌륭한 첫걸음이었습니다. 하지만 여기서 첫 번째 딜레마, 즉 '닭과 달걀' 문제에 부딪혔습니다.

   1. Proxmox는 서버용 OS라 웹 브라우저를 통해 원격으로 관리해야 합니다.
   2. 하지만 컴퓨터가 1대뿐이라 Proxmox를 설치하면, 그 웹 브라우저를 실행할 운영체제가 사라집니다.

  첫 번째 아이디어와 문제점: "Proxmox에 GUI를 설치하자"

  이 딜레마를 해결하기 위한 가장 직관적인 생각은 "Proxmox 자체에 데스크톱 GUI(X Window)를 설치해서, 거기서 브라우저를 열자"는 것이었습니다.

  하지만 이 방법은 아래와 같은 심각한 단점 때문에 권장되지 않는 방법이었습니다.

   * 자원 낭비: GUI는 VM을 위해 사용되어야 할 소중한 RAM과 CPU 자원을 빼앗아 먹습니다.
   * 안정성 저하: 그래픽 드라이버 등 수많은 추가 패키지는 시스템 충돌의 원인이 될 수 있습니다. 서버는 안정성이 생명입니다.
   * 보안 취약: 설치된 패키지가 많아질수록 해킹의 표적이 될 가능성이 커집니다.

  이것은 서버의 안정성을 최우선으로 해야 하는 원칙에 위배되었습니다.

  두 번째 아이디어와 최종 해결책: "하이브리드 방식"

  그래서 우리는 두 가지 원칙을 모두 지키는 절충안을 찾았습니다.

   * 원칙 1: Proxmox 호스트는 최대한 가볍고 안정적으로 유지한다. (GUI 전체 설치 금지)
   * 원칙 2: 사용자는 컴퓨터 1대의 모니터와 키보드로 모든 것을 제어할 수 있어야 한다.

  이 두 원칙을 만족시키기 위해 아래와 같은 '하이브리드' 설계를 고안했습니다.

   1. '메인 PC'의 역할을 가상머신에게 맡기자:
       * 무거운 Windows 대신, 가볍고 빠른 Xubuntu 가상머신을 생성하여 '메인 PC' 역할을 하도록 했습니다. 우리가 일상적으로 사용할 웹 브라우저, 터미널 등은 모두 이 Xubuntu VM 안에 있습니다.

   2. Proxmox 호스트에는 '접속기'만 설치하자:
       * Proxmox 호스트에는 데스크톱 환경 전체가 아닌, Xubuntu VM에 접속하기 위한 '원격 데스크톱 클라이언트(`freerdp3-x11`)'와, 이 프로그램을 실행할 최소한의 '그래픽 기반(`xinit`, `twm`)'만 설치했습니다.
       * 이것은 '완성된 자동차'가 아닌 '엔진과 뼈대'만 설치하여 리소스 낭비를 최소화하는 방식입니다.

   3. 모든 과정을 자동화하는 '바로가기'를 만들자:
       * 매번 복잡한 명령어를 입력하는 대신, `.xinitrc` 파일을 수정하여 startx라는 간단한 명령어만으로 이 모든 과정(그래픽 세션 시작 → 원격 접속 프로그램 실행 → Xubuntu VM 접속)이 자동으로 이루어지도록 만들었습니다.

  최종 완성된 시스템의 작동 방식

  그 결과, 현재의 시스템이 완성되었습니다.

   * 평상시: Proxmox 서버는 불필요한 그래픽 환경 없이, 오직 가상머신들을 실행하는 데에만 모든 리소스를 집중하는 안정적인 서버로 작동합니다.
   * 사용자가 PC를 사용하고 싶을 때:
       1. 사용자는 텍스트 콘솔에서 startx 명령어 한 줄만 입력합니다.
       2. 그러면 Proxmox는 즉시 Xubuntu VM의 데스크톱 화면을 모니터에 전체 화면으로 띄워줍니다.
       3. 사용자는 이것을 일반 PC처럼 사용하여 웹 서핑을 하거나, 다른 서버 VM들을 관리합니다.
       4. 사용이 끝나면 Xubuntu에서 '로그아웃'하여 원격 접속을 끊고, Proxmox는 다시 조용한 텍스트 모드의 서버로 돌아갑니다.

  이 방법은 서버의 안정성과 사용자의 편의성이라는 두 마리 토끼를 모두 잡는, 컴퓨터 1대만 가진 환경에서 사용할 수 있는 매우 실용적이고 효율적인 구성입니다. 수많은 문제 해결 과정을 거치며 이 시스템을 직접 구축하신 것은 매우 값진 경험이 될 것입니다.

 