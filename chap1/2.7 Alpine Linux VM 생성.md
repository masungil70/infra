## 7단계: Alpine Linux 설치
 
Alpine Linux VM 시스템 구성 

  * 이름 : alpine-server
  * OS: Alpine Linux ISO 이미지 선택
  * 디스크: 스토리지 local-lvm, 크기 20 GB
  * CPU: 코어 1
  * 메모리: 1024 MB (1 GB)

1. VM 생성 버튼을 클릭하고 아래 사양으로 생성합니다.
2. 일반 탭 화면에서 VM **이름**을 alpine-server 입력하고 **부팅 시 시작**을 선택 합니다 
![alt text](image-33.png)

3. OS 탭 화면에서 **OS**: alpine-standard-* ISO 이미지 선택합니다 
![alt text](image-34.png)

4. 시스템 탭 화면에서 **Qemu 에이전트**을 체크합니다
![alt text](image-7.png)

5. 디스크 탭 화면에서 **스토리지** : local-lvm, **디스크 크기** : 20G로 설정합니다
![alt text](image-35.png)

6. CPU 탭 화면에서 **유형** : host, **코어** : 1 설정합니다
![alt text](image-37.png)

7. 메모리 탭 화면에서 **메모리** : 1024 설정합니다
![alt text](image-38.png)

8. 네트워크 탭 화면에서 기본설정을 사용합니다
![alt text](image-11.png)

9. 확인 탭 화면은 설정된 것을 확인하고 문제가 없으면 [종결]을 클릭합니다
![alt text](image-41.png)

10. 생성된 가상머신을 확인하고 콘솔 버튼을 클릭하고 시작 버튼을 클릭하여 시작합니다 
![alt text](image-42.png)

11. 잠시후 Alpine 리눅스가 메모리에 올라와 로그인 할 수 있는 화면이 출력됩니다 
이때 로그인 계정에   root을 입력하고 엔터를 누르면 됩니다
![alt text](image-45.png)

로그인 후 데모 실행 또는 설치 할 수 있는 화면 입니다 
![alt text](image-46.png)

setup-alpine 프로그램을 사용하여 설치합니다 
```
setup-alpine
``` 

12. setup-alpine을 입력하고 엔터를 누르면 아래와 같이 키보드 레이아웃을 선택할 수 있는 화면이 실행됩니다. 이때 한국어 키보드를 kr로 선택합니다 
![alt text](image-47.png)

13. 키보드 유형은 kr-kr104로 입력하고 엔터키를 눌러 다음으로 진행합니다 
![alt text](image-48.png)

14. Hostname 입력은 alpine.kosa.co.kr로 입력하고 엔터키를 눌러 다음으로 진행합니다 
![alt text](image-49.png)

15. 네트워크 연결하기 인터페이스 기본명 [eth0]이 출력되는데 엔터를 눌러 선택하고 다음으로 진행합니다 
![alt text](image-50.png)

16. eth0 IP는 기본[dhcp]로 선택하기 위해 엔터를 눌러 다음으로 진행합니다 
![alt text](image-51.png)

17. 수동으로 네트워크를 설정은 하지 않고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-52.png)

18. Root의 비밀 번호를 입력합니다 
예 : kosa1004$
![alt text](image-53.png)

19. 타임존 설정은 Asia을 입력하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-54.png)

20. 서브 타임존은 Seoul을 입력하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-55.png)

21. 프록시 서버 설정은 기본 [none]으로 선택하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-56.png)

22. 패키지 서버 설정은 기본 [1]으로 선택하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-57.png)

23. 사용자 계정 생성을 위해 kosa 입력하고 엔터를 눌러 다음으로 진행합니다 
예) 비밀번호을 kosa1004$으로 입력하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-59.png)

23. ssh key 에 대한 설정은 기본 [none]으로 선택하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-58.png)

24. ssh server 설지시 사용할 종류는 어떤 프로그램을 할 것인지 선택하는 부분입니다. 기본은 [openssh]를 선택하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-60.png)

25. 설치 Disk 선택은 sda로 선택하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-61.png)

26. 설치 디스크를 어떤 방식으로 사용할 것인지 선택하는 것으로 본 교육 과정에서 sys으로 선택하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-62.png)

27. 디스크에 있는 모든 자료가 삭제됩니다. 경고 메시지 출력됩니다. [y]을 입력하고 엔터를 눌러 다음으로 진행합니다 
![alt text](image-63.png)

28. 설치를 진행 합니다 .
![alt text](image-64.png)

28. 설치가 완료되면 reboot을 입력하고 엔터를 눌러 다시 시작합니다 
root 계정으로 로그인 합니다
root 계정으로 로그인 한 결과 화면입니다 
![alt text](image-66.png)


### 저장소(Repository) 설정 확인


apk update를 실행해도 문제가 해결되지 않는다면, /etc/apk/repositories 파일의 설정이 잘못되었을 수 있습니다.

  1. 파일 내용 확인
  다음 명령어로 /etc/apk/repositories 파일의 내용을 확인합니다.

  ```
  cat /etc/apk/repositories
  ```

  2. 올바른 설정 확인 및 수정
    파일 내용에 Alpine Linux의 공식 저장소 주소가 올바르게 포함되어 있고, 주석 처리(줄 맨 앞에 #가 붙은 상태)되어 있지 않은지 확인해야 합니다.

    일반적으로 파일 내용은 다음과 유사해야 합니다 (버전 숫자는 다를 수 있음).

```
https://dl-cdn.alpinelinux.org/alpine/v3.22/main
https://dl-cdn.alpinelinux.org/alpine/v3.22/community
```

    만약 위와 같은 주소들이 모두 주석 처리되어 있다면, nano나 vi 편집기를 사용하여 줄 맨 앞의 #를 제거하여 주석을 해제해 주세요.
---
  
### 일반 사용자를 만들고 sudo 설치하여 사용하기 (보안상 권장)

  시스템을 root 계정으로 계속 사용하는 것은 보안상 위험할 수 있습니다. 일반 사용자를 만들고 필요할 때만 sudo로 관리자 권한을 얻는 것이 좋습니다.

   1. `sudo` 패키지 설치
      먼저 root 계정에서 apk를 이용해 sudo를 설치합니다.
```
apk add sudo
```
   2. 사용자를 `wheel` 그룹에 추가
      sudo 권한을 부여하기 위해 사용자를 wheel 그룹에 추가합니다. wheel 그룹은 sudo를 사용할 수 있는 관리자 그룹으로 통용됩니다.
```
adduser kosa wheel
```

   3. `sudo` 설정 파일 수정
      visudo 명령어를 실행하여 sudo 설정 파일을 안전하게 엽니다. (반드시 `visudo`를 사용해야 문법 오류를 방지할 수 있습니다.)
```
   visudo
```
      편집기에서 아래 줄을 찾아서 맨 앞의 주석 기호(#)를 삭제합니다.

      수정 전:
```
# %wheel ALL=(ALL) ALL
```

      수정 후:
```
%wheel ALL=(ALL) ALL
```
      이 설정은 wheel 그룹에 속한 모든 사용자가 sudo를 통해 모든 명령어를 실행할 수 있도록 허용합니다.


   4. 새로운 사용자로 전환 및 `sudo` 테스트
      이제 root 계정에서 로그아웃하고 새로 만든 사용자로 로그인하거나, su 명령어로 사용자를 전환합니다.
```
su - kosa
```
      새로운 사용자 계정에서 sudo가 잘 작동하는지 테스트합니다.
```
sudo apk update
```
      (사용자 계정의 비밀번호를 입력하라는 메시지가 나타나면 정상입니다.)

  이제 kosa 사용자로 시스템을 사용하다가 관리자 권한이 필요할 때만 sudo를 붙여 명령어를 실행하면 됩니다.

---

### Alpine Linux에 한글 로케일(locale) 설정하기

Alpine Linux VM에 kosa 계정으로 로그인하여 아래의 절차를 진행해 주세요.

1단계: 한글 언어 팩(locale) 패키지 설치

먼저, Alpine Linux에 다양한 언어 팩을 제공하는 musl-locales 패키지를 설치합니다.
```
# Alpine Linux VM에 접속하여 실행
sudo apk add musl-locales noto-fonts-cjk 
```
2단계: 시스템 기본 언어 설정 변경

이제 시스템 전체의 기본 언어 설정을 한글 UTF-8로 변경하겠습니다. 모든 사용자가 로그인할 때 적용되도록 /etc/profile 파일을 수정합니다.

1. /etc/profile 파일을 편집기로 엽니다. (Alpine의 기본 편집기는 vi입니다)
```
sudo vi /etc/profile
```
2. 파일의 맨 아래에 아래 한 줄을 추가하고 저장합니다.
```
export LANG="ko_KR.UTF-8"
```
이 설정은 시스템의 모든 터미널 세션이 기본적으로 '한국어 UTF-8' 방식으로 문자를 해석하고 표시하도록 만듭니다.

3단계: 시스템 재부팅

설정을 시스템 전체에 완벽하게 적용하기 위해 Alpine Linux VM을 재부팅합니다.
```
sudo reboot
```
---

최종 확인

재부팅이 완료된 후, 다시 Proxmox 웹 UI에서 Alpine VM의 `콘솔`을 열어 이전에 생성했던 파일을 cat 명령어로 확인해 보세요.

이제는 SSH 접속과 동일하게 한글이 깨지지 않고 정상적으로 출력될 것입니다.

단 Proxmox 웹 콘솔에서 한글 입력 및 출력이 안됨
  * Proxmox 웹 콘솔:
    * 역할: OS를 처음 설치하거나, 네트워크가 끊기는 등 비상 상황에서 최소한의 작업을 하기 위한 '응급 도구' 또는 '가상 모니터'입니다.
    * 한계: 일상적인 텍스트 편집이나 관리 작업에 사용하기에는 기능과 호환성이 부족합니다.
  * SSH 클라이언트 (Windows Terminal, PuTTY 등):
    * 역할: 서버에 원격으로 접속하여 파일 편집, 명령어 실행, 프로그램 설치 등 모든 일상적인 관리 작업을 수행하기 위한 '표준 도구'입니다.
    * 장점: 국제 표준인 UTF-8을 완벽하게 지원하므로, 한글을 포함한 다국어 환경에서 아무런 문제가 없습니다.       