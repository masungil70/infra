## object 타입 변수 선언 방법

Terraform에서 "구조체(struct) 형식"으로 변수를 선언하는 방법은 object 타입 제약을 사용하는 것입니다. object 타입은 여러 개의 명명된 속성(attribute)을 가질 수 있으며, 각 속성마다 특정 타입 제약을 지정할 수 있습니다. 이는 다른 프로그래밍 언어의 구조체나 객체와 매우 유사합니다.

object 타입 변수 선언 방법

object 타입 변수를 선언할 때는 type 키워드 뒤에 object({ ... }) 형태로 속성 이름과 그 속성의 타입을 명시해줍니다.

기본 구문:

```
    1 variable "<변수_이름>" {
    2   description = "변수에 대한 설명"
    3   type        = object({
    4     <속성1_이름> = <속성1_타입>,
    5     <속성2_이름> = <속성2_타입>,
    6     # ...
    7   })
    8   default     = {
    9     <속성1_이름> = <기본값1>,
   10     <속성2_이름> = <기본값2>,
   11     # ...
   12   }
   13 }
```

* <속성_이름>: 구조체의 필드(멤버) 이름입니다.
* <속성_타입>: 해당 필드의 타입입니다. (예: string, number, bool, list(string), map(string), 또는 중첩된 object({...}) 등)

Cloud-Init 사용자 이름과 비밀번호와 ssh key를 object type으로 선언하고 설정하고 사용하는 예를 알아보겠습니다.

1.  변수선언

cloud-init 및 ssh 공개키 설정시 사용될 변수를 Object 타입으로 선언 varialbes.tf 파일에 아래와 같이 정의 합니다

```
vi variables.tf
...
# cloud-init 및 ssh 공개키 설정시 사용될 변수를 Object 타입으로 선언
variable ciValue {
  type = object({
    user = string     # "Cloud-Init 사용자 이름"
    password = string # "Cloud-Init 사용자 암호"
    ssh_key = string  # "VM에 주입할 사용자의 SSH 공개 키"
  })
  description = "cloud-init 및 ssh 공개키 설정시 사용될 변수"
}
```

2. 변수 값 설정 

선언된 변수에 값을 설정하는 것은 terraform.tfvars 파일에 아래와 같이 정의 합니다.

```
vi terraform.tfvars
...
# Cloud-Init 정보
ciValue = {
    user     = "kosa"
    password = "kosa1004"
    ssh_key  = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDpwqCCgjmIB/******"  
} 

```

3. 선언된 변수의 값 사용 

```
vi step12.tf

...
  # Cloud-Init 사용자 이름과 비밀번호 및 ssh 키 설정을 각각의 변수를 사용하여 접근 한 것을 아래와 같이 변경 합니다.
  # ciuser     = var.ciuser
  # cipassword = var.cipassword
  # sshkeys    = var.ssh_public_key

  # Cloud-Init 사용자 이름과 비밀번호 및 ssh 키 설정
  ciuser     = var.ciValue.user
  cipassword = var.ciValue.password
  sshkeys    = var.ciValue.ssh_key

```

#### 실행 방법:
```bash
terraform init
terraform plan
terraform apply -auto-approve
```

생성된 가상 머신에 접속해 봅니다
```
userid : kosa
password : kosa1004
```
입력하면 로그인이 되는 것을 확인할 수 있습니다

* terraform apply의 실행결과로 server_ip을 확인해봅니다.
* 생성된 가상머신에 로그인하여 ip a 명령으로 ip을 확인합니다.
* server_ip와 ip a 명령의 결과 같은지 확인합니다.

* ip의 주소(예 : 192.168.0.4)으로 ssh로 접속할 때 공개키로 접속이 되는 것을 확인할 수 있습니다
